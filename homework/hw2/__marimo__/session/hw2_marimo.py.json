{
  "version": "1",
  "metadata": {
    "marimo_version": "0.19.9"
  },
  "cells": [
    {
      "id": "setup",
      "code_hash": "e0f4cbb35013f28240ea56c35bbf7ea0",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "File \u2018hw2_tests.py\u2019 already there; not retrieving.\n\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "Hbol",
      "code_hash": "eff392858a61574e7f10fcba92ad03e9",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"homework-2-automatic-differentiation-and-linear-models\">Homework 2 - Automatic differentiation and linear models</h2>\n<span class=\"paragraph\">This homework contains two main portion.  In part one, you will implement an extremely minimal automatic differentiation module.  This is the same technique that underlies PyTorch, and while you will not implement anything close to the complexity of a library like PyTorch, it will give you a basic understanding of the basic principles of the approach, giving you some insight into how the nuts and bolts of PyTorch do work under the hood.  In the second part, you will use the (built in) automatic differentiation tooling of PyTorch to train a simple linear model; note that for this assignment you won't do this in the \"normal\" PyTorch way of defining PyTorch Module subclasses, optimizer subclasses, and this sort of thing (that will be done in the next homework, on neural networks), but you will use the basic gradient descent approach to build a simple linear model.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "MJUe",
      "code_hash": "a6146191808072223b8825322ab365d4",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "vblA",
      "code_hash": "5d92859d2db04dbcb7f553ef9d6531fa",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"part-i-automatic-differentiation\">Part I - Automatic differentiation</h2>\n<span class=\"paragraph\">As the core of automatic differentiation is a technique that builds a <em>compute graph</em>, which constructs a graph out of a series of functions applied to variables.  In our setting, we will implement this functionality with two simple classes: a <code>Variable</code> class that represents the variables will will differentiate with respect to and a <code>Function</code> class that contains the logic to both implement the function itself and compute its gradient.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "bkHC",
      "code_hash": "48a49c14e559d5ace9c76ed796ce6ebd",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "lEQa",
      "code_hash": "5be307594e8d66a92125b7852a181ad0",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "PKri",
      "code_hash": "2e9e025973435c7e35b39deba585f65f",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">Let's discuss in some detail how the automatic differentiation works, which is best understood by an example.  Let's consider the following operation for two variables <code>x</code> and <code>y</code>:\n<div class=\"language-scdoc codehilite\"><pre><span></span><code>(x*y + x**2)/y\n</code></pre></div>\nTo be even more explicit, let's assign names to all the intermediate terms generated by this computation\n<div class=\"language-scdoc codehilite\"><pre><span></span><code>a = x*y\nb = x**2\nc = a + b\nd = c / y\n</code></pre></div>\nSuch a operation would correspond to the following computation graph:</span>\n<span class=\"paragraph\"><img alt=\"computation graph\" src=\"https://raw.githubusercontent.com/modernaicourse/hw2/refs/heads/main/computation_graph.svg\" /></span>\n<span class=\"paragraph\">In this graph, the original variables and intermediate terms are represented as nodes, and the parents of a node represent the variables that were used to compute that term.  Although not depicted in the graph, each variable in the graph also stores a link to the function that created that variable (as a function of its parents).</span>\n<span class=\"paragraph\">In our code, these computations graphs are modeled implicitly via the <code>Variable</code> class.  Specifically, the class contains the following items:</span>\n<ul>\n<li><code>.value</code> : a <code>float</code> value that contain the numerical value of the variable</li>\n<li><code>.grad</code> : a <code>float</code> value (or <code>None</code>) that will be populated with the variable's derivative with respect to a final function</li>\n<li><code>.parents</code> : the parents of the node in the graph or <code>None</code> if the node has no parents</li>\n<li><code>.function</code> : a reference to the function that was used to create the note from its parents (which will be a reference to an instance of the <code>Function</code> class)</li>\n<li><code>.num_children</code> : the number of children that each node has (this will be needed for counting whether all children have already computed their gradient, we could compute it online, but this would make the code more complex)</li>\n</ul>\n<span class=\"paragraph\">In addition to the <code>Variable</code> class, there is also a <code>Function</code> class that creates variables in a fashion that builds the graph.  Specifically, the <code>__call__</code> method of the class implements the routine that constructs the graph. This lets you call a function like multiplication in the following manner:\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"n\">Multiply</span><span class=\"p\">()(</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"p\">)</span>\n</code></pre></div>\nwhich initializes the <code>Multiply()</code> class and then calls the resulting with arguments <code>x</code> and <code>y</code>, which invokes the <code>__call__()</code> function.</span>\n<span class=\"paragraph\">Subclasses of <code>Function</code> need to implement two methods:</span>\n<ol>\n<li>The <code>.forward()</code> method actually computes the function.  For instance, the forward method of a <code>Multiply</code> class would multiply two numbers together, the forward pass of the <code>Log</code> class would take the log of a variable, etc.  As you see from the implementation above, this forward call is called by the <code>__call__()</code> class, but with additional code that constructions the graph.</li>\n<li>The <code>.backward()</code> function computes the <em>product</em> of what's referred to as an \"incoming derivative\" term (this will correspond to the already-computed derivative of nodes later in the graph), and the <em>partial derivatives</em> of this function.  In general, the arguments to the backward function will always be both this incoming derivative and the arguments to the original function.  For example, if we consider some function of two variables <marimo-tex class=\"arithmatex\">||(f(x,y)||)</marimo-tex>, and incoming derivative <marimo-tex class=\"arithmatex\">||(g \\in \\mathbb{R}||)</marimo-tex>, then the <code>.backward()</code> function would compute two separate product of partial derivatives, which are returned as a list.</li>\n</ol>\n<marimo-tex class=\"arithmatex\">||[ \\frac{\\partial f(x,y)}{\\partial x} \\cdot g, \\;\\; \\frac{\\partial f(x,y)}{\\partial y} \\cdot g ||]</marimo-tex></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Xref",
      "code_hash": "bed887a1951f3e0b70cd1e85a03dda95",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"example-multiplication\">Example: multiplication</h3>\n<span class=\"paragraph\">Let's see how these look in a few examples.  First let's show the implementation of a <code>Multiply</code> function:</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "SFPL",
      "code_hash": "b98cf7c3cc26dea440fd397595daf7e7",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "BYtC",
      "code_hash": "5e5a2ede48d35fd1733f6f463030ac57",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">In this case, we are defining the function</span>\n<marimo-tex class=\"arithmatex\">||[f(x,y) = x y.||]</marimo-tex><span class=\"paragraph\">The <code>.forward()</code> function simply implements this multiplication, <code>x*y</code>.  Furthermore, the partial derivatives of this particular function are given by</span>\n<marimo-tex class=\"arithmatex\">||[\\frac{\\partial f(x,y)}{\\partial x} = y, \\;\\; \\frac{\\partial f(x,y)}{\\partial y} = x.||]</marimo-tex><span class=\"paragraph\">Thus the <code>.backward()</code> function computes the product of the incoming derivative <code>grad</code> and each of these partial derivatives, and return them as a list.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "RGSE",
      "code_hash": "f8d7bd137f7700f33c68a5013d730e2b",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"example-negation\">Example: Negation</h3>\n<span class=\"paragraph\">Let's look at one more example, this time a function with a single argument, given by <marimo-tex class=\"arithmatex\">||(f(x) = -x||)</marimo-tex>.  In this case, the partial derivative is given by</span>\n<marimo-tex class=\"arithmatex\">||[\\frac{\\partial f(x)}{\\partial x} = -1||]</marimo-tex><span class=\"paragraph\">so the <code>.backward()</code> function returns <code>[-grad]</code> (note that the backward function <em>always</em> returns a list, in this case of just one element, even if the function has only one argument).</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Kclp",
      "code_hash": "10c7dfef572bca886441c340cfdaf1a5",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "emfo",
      "code_hash": "9df4eddcbbdb2711ff3828ab7d677999",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"question-1-function-implementations\">Question 1 - Function implementations</h3>\n<span class=\"paragraph\">Implement the following <code>Function</code> classes to complete the implementation of the operators listed in the <code>Variable</code> class.  We are just providing the class definition itself: you'll need to define and implement <code>.forward()</code> and <code>.backward()</code> functions in each of these.  Remember that <code>.backward()</code> needs to always return a <em>list</em> of products between the incoming derivative and each partial derivative, even if there is only a single argument.</span>\n<span class=\"paragraph\">The one slightly-less straightforward implementation here is the <code>Power</code> class, which computes the operation <code>x**d</code>.  In this case, we won't actually enable differentation with respect to the <code>d</code> variable (we certainly could, it's just a slightly more involved implementation function, so we don't do it in this assignment).  Thus, for this implementation, we'll store the <code>d</code> value in the class itself, and pass it to the <code>__init__()</code> operation of the function.  This is what's done in the <code>Variable</code> class above, i.e., whereas we call the <code>Mulitply</code> class like the following:\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"n\">Multiply</span><span class=\"p\">()(</span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"n\">y</span><span class=\"p\">)</span>\n</code></pre></div>\n(i.e., we initialize the class, then call it with the <code>x</code> and <code>y</code> arguments).  You would call <code>Power</code> via the following:\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"n\">Power</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">)(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n</code></pre></div></span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Hstk",
      "code_hash": "e9180a12283782472d7bc78641805766",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "nWHF",
      "code_hash": "019b963a015a1a343e606080e0cad3b2",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m_____________________________ .hw2.test_Add_local ______________________________\u001b[0m\n\n    def test_Add_local():\n>       test_Add(Add)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:53: in test_Add\n    assert(f.forward(2.5, -0.5) == 2.0)\n           ^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <__main__.Add object at 0x163eb8550>, args = (2.5, -0.5)\n\n    def forward(self, *args):\n>       raise NotImplementedError\n\u001b[1m\u001b[31mE       NotImplementedError\u001b[0m\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:8: NotImplementedError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_Add_local\u001b[0m - NotImplementedError\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "iLit",
      "code_hash": "3d059e02a5631ba64c674450f75a8bc7",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='iLit-0' random-id='dcfb272d-3ec1-de8f-433f-2d452df44e6c'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;Add&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "ZHCJ",
      "code_hash": "1556ab19418789c06ec808e6e8d5c490",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "ROlb",
      "code_hash": "5bb2cf68fef5653a118575f59c8639d0",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "qnkX",
      "code_hash": "09ff8462b17cda53b0c4bb221571a2b3",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m___________________________ .hw2.test_Subtract_local ___________________________\u001b[0m\n\n    def test_Subtract_local():\n>       test_Subtract(Subtract)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:67: in test_Subtract\n    assert(f.forward(2.5, -0.5) == 3.0)\n           ^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <__main__.Subtract object at 0x163e5ccd0>, args = (2.5, -0.5)\n\n    def forward(self, *args):\n>       raise NotImplementedError\n\u001b[1m\u001b[31mE       NotImplementedError\u001b[0m\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:8: NotImplementedError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_Subtract_local\u001b[0m - NotImplementedError\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "TqIu",
      "code_hash": "da40ccd94713df153bbaf920bc496b67",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='TqIu-0' random-id='58d54e0e-e9c9-7525-d9e3-f0361633ddba'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;Subtract&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Vxnm",
      "code_hash": "2cc04206d0ee5ab3e6482c50091f97d1",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "DnEU",
      "code_hash": "ac946777c6ad1041b83ffd54a737fb6b",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "ulZA",
      "code_hash": "7b4a53fdd15d18e8c7f40f59cd3e48ae",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m____________________________ .hw2.test_Divide_local ____________________________\u001b[0m\n\n    def test_Divide_local():\n>       test_Divide(Divide)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:81: in test_Divide\n    assert(f.forward(9.0, 3.0) == 3.0)\n           ^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <__main__.Divide object at 0x163424910>, args = (9.0, 3.0)\n\n    def forward(self, *args):\n>       raise NotImplementedError\n\u001b[1m\u001b[31mE       NotImplementedError\u001b[0m\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:8: NotImplementedError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_Divide_local\u001b[0m - NotImplementedError\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "ecfG",
      "code_hash": "a67dec715cf25be754688ff706a3c8b8",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='ecfG-0' random-id='9ec00d81-e64f-a419-6ec7-013e7d69c330'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;Divide&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "Pvdt",
      "code_hash": "915da4469dc1eba419d4f8394999ee1c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "ZBYS",
      "code_hash": "526fd95eae5006aac0872f24545932fe",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "aLJB",
      "code_hash": "667640cfc2bb452f319fd3b598fe0764",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m____________________________ .hw2.test_Power_local _____________________________\u001b[0m\n\n    def test_Power_local():\n>       test_Power(Power)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nPower = <class '__main__.Power'>\n\n    def test_Power(Power):\n>       f = Power(3)\n            ^^^^^^^^\n\u001b[1m\u001b[31mE       TypeError: Power() takes no arguments\u001b[0m\n\n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:95: TypeError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_Power_local\u001b[0m - TypeError: Power() takes no arguments\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "nHfw",
      "code_hash": "5627edb04846b72162aa1870d0920d72",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='nHfw-0' random-id='d584d142-ed25-2944-5515-3ecbd790fdfb'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;Power&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "xXTn",
      "code_hash": "dea626070d8abdfd397f062322f1c7e0",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "AjVT",
      "code_hash": "ee59ae087c9891f5cae0f72ee53b9120",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "pHFh",
      "code_hash": "40fde92e4338c9f6743e1e57cec635a1",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m_____________________________ .hw2.test_Log_local ______________________________\u001b[0m\n\n    def test_Log_local():\n>       test_Log(Log)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:118: in test_Log\n    assert(math.isclose(f.forward(math.e), 1.0))\n                        ^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <__main__.Log object at 0x163e5ccd0>, args = (2.718281828459045,)\n\n    def forward(self, *args):\n>       raise NotImplementedError\n\u001b[1m\u001b[31mE       NotImplementedError\u001b[0m\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:8: NotImplementedError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_Log_local\u001b[0m - NotImplementedError\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "NCOB",
      "code_hash": "a35dc8712ede6601e3b4a5eb3815ca1d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='NCOB-0' random-id='470f9d73-af74-838e-313a-4cd2a2ce75b6'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;Log&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "aqbW",
      "code_hash": "50a0c96ea2da8f9a0905a80cbefab0e9",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "TRpd",
      "code_hash": "bd1ed18c2c90c29e31884f3083b5fa05",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "TXez",
      "code_hash": "dadded7a81bfa1fd08767a8f9f675d96",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m_____________________________ .hw2.test_Exp_local ______________________________\u001b[0m\n\n    def test_Exp_local():\n>       test_Exp(Exp)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:132: in test_Exp\n    assert(math.isclose(f.forward(1.0), math.e))\n                        ^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <__main__.Exp object at 0x164890410>, args = (1.0,)\n\n    def forward(self, *args):\n>       raise NotImplementedError\n\u001b[1m\u001b[31mE       NotImplementedError\u001b[0m\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:8: NotImplementedError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_Exp_local\u001b[0m - NotImplementedError\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "dNNg",
      "code_hash": "97e565caa472b7c398d27a45205b6eae",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='dNNg-0' random-id='0ad4dcaf-cce3-676a-b7fe-635eeccd4e24'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;Exp&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "yCnT",
      "code_hash": "e0b79f1b79a9b2c9c994722f3154f43c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "wlCL",
      "code_hash": "397095be89e2f336b7755945f539a86a",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">If you implement all the following arguments above, you should be able to run the following code that will implicitly build a compute graph of the following expression we described above.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "kqZH",
      "code_hash": "1ee0242e5b2ca625dcae5eb506489b0f",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "Power() takes no arguments",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/var/folders/w2/5g3ht4h93vqb3l6zf_5hv6w40000gp/T/marimo_99527/__marimo__cell_kqZH_.py&quot;</span>, line <span class=\"m\">3</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">d</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">*</span> <span class=\"n\">y</span> <span class=\"o\">+</span> <span class=\"n\">x</span><span class=\"o\">**</span><span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"n\">y</span>\n<span class=\"w\">                 </span><span class=\"pm\">~^^~</span>\n  File <span class=\"nb\">&quot;/var/folders/w2/5g3ht4h93vqb3l6zf_5hv6w40000gp/T/marimo_99527/__marimo__cell_lEQa_.py&quot;</span>, line <span class=\"m\">40</span>, in <span class=\"n\">__pow__</span>\n<span class=\"w\">    </span><span class=\"k\">return</span> <span class=\"n\">Variable</span><span class=\"o\">.</span><span class=\"n\">_apply</span><span class=\"p\">(</span><span class=\"n\">Power</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"p\">)</span>\n<span class=\"w\">                           </span><span class=\"pm\">~~~~~^^^</span>\n<span class=\"gr\">TypeError</span>: <span class=\"n\">Power() takes no arguments</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "wAgl",
      "code_hash": "31123669a95fba9e65160df2ed548074",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"question-2-implementing-the-full-backward-pass\">Question 2 - Implementing the full backward pass</h3>\n<span class=\"paragraph\">Given the functions defined above, now you'll implement the actual automatic differentiation pass that will extend the Variable class to compute gradients in a computation graph.  This is done with a <code>compute_gradients()</code> function called on the <code>Variable</code> instance [Note: in PyTorch this function is also called <code>.backward()</code>, but that can be a bit confusing since the method in <code>Function</code> is called the same thing, so I want to differentiate.]</span>\n<span class=\"paragraph\">The basic algorithm is quite simple, and we'll outline it here, then explain some of the intuition behind it.  Note that this implementation makes a very simplifying assumptions (for instance, it requires that variables not be used anywhere <em>except</em> in the computation of the final output we are differentiating, or their <code>num_children</code> could will never reach zero), and it doesn't e.g., let you compute gradients multiple times (because it actively manipulates the <code>num_children</code> counters) but it nonetheless works for our simple cases.  The algorithm is as follows:</span>\n<h4 id=\"backward-pass-compute_gradients-called-on-variable-instance\">Backward pass <code>compute_gradients()</code> called on <code>Variable</code> instance:</h4>\n<ol>\n<li>If the <code>grad</code> variable of node is <code>None</code> (i.e., this is the final function being differentiated), set to 1.0.</li>\n<li>\n<span class=\"paragraph\">If the node has <code>parents</code> and <code>function</code> values (i.e., it is a computed node):</span>\n<ol>\n<li>Call the function's <code>backward()</code> implementation passing the node's <code>grad</code> value and the parent's values. This returns a list of products <code>grad</code> and the partial derivatives of the function.</li>\n<li>\n<span class=\"paragraph\">For each of the node's parents:</span>\n<ul>\n<li>Add the corresponding grad/partial derivative product to the parent's <code>.grad</code> property (or set it if the <code>grad</code> is currently None).</li>\n<li>Decrease the <code>num_children</code> parameter of the parent</li>\n<li>If the parent's <code>num_children</code> is zero, call it's <code>.compute_gradient()</code> method recursively.</li>\n</ul>\n</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"worked-through-example\">Worked-through example</h3>\n<span class=\"paragraph\">Let's see how this works in a slightly different version of our example above (we'll ignore that last computation step, just to keep things simpler).  Note that going through all of this at first may not be needed, but it can be helpful to go through as you debug your implementation.\n<div class=\"language-scdoc codehilite\"><pre><span></span><code>a = x*y\nb = x**2\nc = a + b\n</code></pre></div>\nAfter we construct the computation graph, say with values <code>x=3.0</code>, <code>y=4.0</code>, it would have the following values\n<div class=\"language-tsql codehilite\"><pre><span></span><code><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Variable</span><span class=\"p\">(</span><span class=\"k\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">3.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grad</span><span class=\"o\">=</span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parents</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">num_children</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Variable</span><span class=\"p\">(</span><span class=\"k\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">4.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grad</span><span class=\"o\">=</span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parents</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">num_children</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Variable</span><span class=\"p\">(</span><span class=\"k\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">12.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grad</span><span class=\"o\">=</span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parents</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x,y</span><span class=\"o\">]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Multiply</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">num_children</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Variable</span><span class=\"p\">(</span><span class=\"k\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">9.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grad</span><span class=\"o\">=</span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parents</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x</span><span class=\"o\">]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">Power</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">num_children</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Variable</span><span class=\"p\">(</span><span class=\"k\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">21.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grad</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">None</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parents</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a,b</span><span class=\"o\">]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Add</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">num_children</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n</code></pre></div>\nWe would call <code>compute_gradients()</code> on <code>c</code>, which would first set <code>c.grad=1.0</code>, corresponding to the simple fact that</span>\n<marimo-tex class=\"arithmatex\">||[\\frac{\\partial c}{\\partial c} = 1.||]</marimo-tex><span class=\"paragraph\">This would then call:\n<div class=\"language-scdoc codehilite\"><pre><span></span><code>grad_partials_products = c.function.backward(c.grad, a.value, b.value) # = [1, 1]\n</code></pre></div>\nand set <code>a.grad</code> and <code>b.grad</code> to each of these values, which represents the fact that</span>\n<marimo-tex class=\"arithmatex\">||[\\frac{\\partial c}{\\partial a} = 1, \\frac{\\partial c}{\\partial b} = 1||]</marimo-tex><span class=\"paragraph\">and decrease the <code>num_children</code> parameter of <code>a</code> and <code>b</code>. These last three nodes would now take on the values\n<div class=\"language-tsql codehilite\"><pre><span></span><code><span class=\"n\">a</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Variable</span><span class=\"p\">(</span><span class=\"k\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">12.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grad</span><span class=\"o\">=</span><span class=\"mf\">1.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parents</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x,y</span><span class=\"o\">]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Multiply</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">num_children</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">b</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Variable</span><span class=\"p\">(</span><span class=\"k\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">9.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grad</span><span class=\"o\">=</span><span class=\"mf\">1.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parents</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">x</span><span class=\"o\">]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nf\">Power</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">num_children</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">c</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Variable</span><span class=\"p\">(</span><span class=\"k\">value</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">21.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">grad</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mf\">1.0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">parents</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"o\">[</span><span class=\"n\">a,b</span><span class=\"o\">]</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">Add</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">num_children</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">)</span>\n</code></pre></div>\nSince the parents of <code>c</code> both have <code>num_children=0</code>, the function would then call <code>.compute_gradients()</code> recursively on each of these nodes.  Let's consider calling <code>a.compute_gradients()</code> first.  This would compute\n<div class=\"language-scdoc codehilite\"><pre><span></span><code>grad_partials_products = a.function.backward(a.grad, x.value, y.value) # = [1*4.0, 1*3.0]\n</code></pre></div>\nwhich after similar updates would result in the values\n<div class=\"language-scdoc codehilite\"><pre><span></span><code>x = Variable(value = 3.0, grad=4.0, parents = None, function = None, num_children=1)\ny = Variable(value = 4.0, grad=3.0, parents = None, function = None, num_children=0)\n</code></pre></div>\nFinally, calling <code>b.compute_gradients()</code>, would compute\n<div class=\"language-scdoc codehilite\"><pre><span></span><code>grad_partials_products = b.function.backward(b.grad, x.value) # = [2*3.0]\n</code></pre></div>\nand result in the final <code>x</code> variable\n<div class=\"language-scdoc codehilite\"><pre><span></span><code>x = Variable(value = 3.0, grad=10.0, parents = None, function = None, num_children=0)\ny = Variable(value = 4.0, grad=3.0, parents = None, function = None, num_children=0)\n</code></pre></div>\nwhich contains all the correct gradients.</span>\n<h3 id=\"your-implementation\">Your implementation</h3>\n<span class=\"paragraph\">Implement the <code>compute_gradients</code> method of the following <code>Variable</code> class as described above.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "rEll",
      "code_hash": "9b8e32695e27cbf22f4d9aa29b0e9002",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "dGlV",
      "code_hash": "2d5f0f7d671d2d3e275c053dd7ab3738",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "SdmI",
      "code_hash": "5c3c74b01eedd502b2a4c6827944c992",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m______________________ .hw2.test_compute_gradients_local _______________________\u001b[0m\n\n    def test_compute_gradients_local():\n>       test_compute_gradients(compute_gradients)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncompute_gradients = <function compute_gradients at 0x163439430>\n\n    def test_compute_gradients(compute_gradients):\n        Variable.compute_gradients = compute_gradients\n    \n        x = Variable(3.0)\n        y = Variable(4.0)\n        z = ((-(x * y) * x * x) * (-y))\n        z.compute_gradients()\n>       assert(z.grad == 1.0)\n               ^^^^^^^^^^^^^\n\u001b[1m\u001b[31mE       AssertionError\u001b[0m\n\n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:151: AssertionError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_compute_gradients_local\u001b[0m - AssertionError\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "lgWD",
      "code_hash": "6128bab8e93e76dcf873c9c10b1bbff8",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='lgWD-0' random-id='0a92eb88-468e-b4ba-aa8e-d12c6ac3be00'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;compute_gradients&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "yOPj",
      "code_hash": "9e0c64cf9c09193a448bc66f4c0f7396",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "fwwy",
      "code_hash": "7f05f99e6518d2df88f7009699949852",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">If your implementation is correct, you can now run commands like the following:</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "LJZf",
      "code_hash": "b7a77fa2eeec5a710f7f3ec12d391d34",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "Power() takes no arguments",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/var/folders/w2/5g3ht4h93vqb3l6zf_5hv6w40000gp/T/marimo_99527/__marimo__cell_LJZf_.py&quot;</span>, line <span class=\"m\">3</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"p\">((</span><span class=\"n\">_x</span> <span class=\"o\">*</span> <span class=\"n\">_y</span> <span class=\"o\">+</span> <span class=\"n\">_x</span><span class=\"o\">**</span><span class=\"mi\">2</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"n\">_y</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">compute_gradients</span><span class=\"p\">()</span>\n<span class=\"w\">                </span><span class=\"pm\">~~^^~</span>\n  File <span class=\"nb\">&quot;/var/folders/w2/5g3ht4h93vqb3l6zf_5hv6w40000gp/T/marimo_99527/__marimo__cell_lEQa_.py&quot;</span>, line <span class=\"m\">40</span>, in <span class=\"n\">__pow__</span>\n<span class=\"w\">    </span><span class=\"k\">return</span> <span class=\"n\">Variable</span><span class=\"o\">.</span><span class=\"n\">_apply</span><span class=\"p\">(</span><span class=\"n\">Power</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"p\">)</span>\n<span class=\"w\">                           </span><span class=\"pm\">~~~~~^^^</span>\n<span class=\"gr\">TypeError</span>: <span class=\"n\">Power() takes no arguments</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "urSm",
      "code_hash": "e9c534eb38053aba5575478f1ace2bbb",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">Or more complex examples:</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "jxvo",
      "code_hash": "8fdd15fbc228bc013b8d6b24aae745ee",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "Power() takes no arguments",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/var/folders/w2/5g3ht4h93vqb3l6zf_5hv6w40000gp/T/marimo_99527/__marimo__cell_jxvo_.py&quot;</span>, line <span class=\"m\">4</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"p\">((</span><span class=\"n\">_x</span> <span class=\"o\">*</span> <span class=\"n\">_y</span> <span class=\"o\">+</span> <span class=\"n\">_x</span><span class=\"o\">**</span><span class=\"mi\">2</span> <span class=\"o\">+</span> <span class=\"n\">_z</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">log</span><span class=\"p\">()</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"n\">_z</span><span class=\"o\">**</span><span class=\"mi\">3</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">exp</span><span class=\"p\">())</span><span class=\"o\">.</span><span class=\"n\">compute_gradients</span><span class=\"p\">()</span>\n<span class=\"w\">                </span><span class=\"pm\">~~^^~</span>\n  File <span class=\"nb\">&quot;/var/folders/w2/5g3ht4h93vqb3l6zf_5hv6w40000gp/T/marimo_99527/__marimo__cell_lEQa_.py&quot;</span>, line <span class=\"m\">40</span>, in <span class=\"n\">__pow__</span>\n<span class=\"w\">    </span><span class=\"k\">return</span> <span class=\"n\">Variable</span><span class=\"o\">.</span><span class=\"n\">_apply</span><span class=\"p\">(</span><span class=\"n\">Power</span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"p\">)</span>\n<span class=\"w\">                           </span><span class=\"pm\">~~~~~^^^</span>\n<span class=\"gr\">TypeError</span>: <span class=\"n\">Power() takes no arguments</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "mWxS",
      "code_hash": "647b3261f9bac654c76c1ccb5275d6eb",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h2 id=\"part-ii-training-a-digit-classifier\">Part II - Training a digit classifier</h2></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "CcZR",
      "code_hash": "596296de01894bd01cd42c59845e9a90",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">In this second part of this lecture, you'll train a linear classifier using PyTorch.  While we showed an example of this process in class, we computed the gradients manually there (without much intuition on how that gradient was derived), and here you'll rely on PyTorch's automatic differentiation to actually compute the gradients.  Note that your implementation here will just be based upon functions, not PyTorch <code>Module</code> classes that are the more standardized way of building models in PyTorch (in the next assignment, we will use these module classes)</span>\n<span class=\"paragraph\">Let's begin by first loading the required data.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "YWSi",
      "code_hash": "c8440cf4b530bd31c4700d3d1dd3f75d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "zlud",
      "code_hash": "6835bf1d54036b73b5c601d259a82988",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"question-3-cross-entropy-loss-and-error\">Question 3 - Cross entropy loss and error</h3>\n<span class=\"paragraph\">Implement the following functions, which compute the cross entropy loss and the error between a set of predictions.  Recall that the cross entropy loss is defined, for <marimo-tex class=\"arithmatex\">||(\\hat{y} \\in \\mathbb{R}^k||)</marimo-tex> and <marimo-tex class=\"arithmatex\">||(y \\in \\{1,\\ldots,k\\}||)</marimo-tex> as</span>\n<marimo-tex class=\"arithmatex\">||[L_{ce}(\\hat{y}, y) = -\\log \\left ( \\frac{\\exp \\hat{y}_y}{\\sum_{j=1}^k \\exp \\hat{y}_j} \\right ) = -\\hat{y}_y + \\log \\sum_{j=1}^k \\exp \\hat{y}_j||]</marimo-tex><span class=\"paragraph\">You can use the PyTorch function <code>torch.logsumexp</code> to compute the last term (this will be more numerically stable for large/small prediction values than individually calling <code>log</code> and <code>exp</code>).</span>\n<span class=\"paragraph\">While you could use e.g. a for loop to compute cross entropy loss, this will be fairly inefficient later on.  Instead, you should use the fact that if you index a 2D tensor with two lists of indexes, it will select the elements corresponding to each of these indexes.  For instead given</span>\n<span class=\"paragraph\"><div class=\"language-python codehilite\"><pre><span></span><code><span class=\"n\">A</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">([[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">],</span> <span class=\"p\">[</span><span class=\"mi\">4</span><span class=\"p\">,</span><span class=\"mi\">5</span><span class=\"p\">,</span><span class=\"mi\">6</span><span class=\"p\">]])</span>\n<span class=\"n\">i</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">([</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n<span class=\"n\">j</span> <span class=\"o\">=</span> <span class=\"n\">torch</span><span class=\"o\">.</span><span class=\"n\">tensor</span><span class=\"p\">([</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">])</span>\n</code></pre></div>\nThen\n<div class=\"language-python codehilite\"><pre><span></span><code><span class=\"n\">A</span><span class=\"p\">[</span><span class=\"n\">i</span><span class=\"p\">,</span><span class=\"n\">j</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">tensor</span><span class=\"p\">([</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">,</span> <span class=\"mi\">3</span><span class=\"p\">,</span> <span class=\"mi\">5</span><span class=\"p\">])</span> <span class=\"c1\"># elements [A[0,0], A[1,1], A[0,2], A[1,1]]</span>\n</code></pre></div></span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "tZnO",
      "code_hash": "8659be7d09692e581f052689d63ec6cb",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "xvXZ",
      "code_hash": "a6c47b6aef0c541457debebb6c1da08d",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m______________________ .hw2.test_cross_entropy_loss_local ______________________\u001b[0m\n\n    def test_cross_entropy_loss_local():\n>       test_cross_entropy_loss(cross_entropy_loss)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncross_entropy_loss = <function cross_entropy_loss at 0x163e8f740>\n\n    def test_cross_entropy_loss(cross_entropy_loss):\n        y_pred = torch.tensor([[2.0, 1.0, 0.0], [0.0, 2.0, 1.0]])\n        y = torch.tensor([0, 2])\n        loss = cross_entropy_loss(y_pred, y)\n>       assert(loss.ndim == 0)\n               ^^^^^^^^^\n\u001b[1m\u001b[31mE       AttributeError: 'NoneType' object has no attribute 'ndim'\u001b[0m\n\n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:176: AttributeError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_cross_entropy_loss_local\u001b[0m - AttributeError: 'NoneType' object has no attribute 'ndim'\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "CLip",
      "code_hash": "cfee1a734b477a443165de65060e9209",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='CLip-0' random-id='68fade5c-3c97-3c55-45c7-3336cebf7f89'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;cross_entropy_loss&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "YECM",
      "code_hash": "fe04c424f6175e12fe6eb85ad2b41ab3",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "cEAS",
      "code_hash": "376735611b2c5a928e3d612bbb07f42a",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "iXej",
      "code_hash": "1c243b4504c363f08f57dfaa716b84b6",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m____________________________ .hw2.test_error_local _____________________________\u001b[0m\n\n    def test_error_local():\n>       test_error(error)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nerror = <function error at 0x164929430>\n\n    def test_error(error):\n        y_pred = torch.tensor([[3.0, 1.0], [0.0, 2.0], [1.0, 1.0], [-1.0, 0.0]])\n        y = torch.tensor([0, 1, 1, 1])\n        err = error(y_pred, y)\n>       assert(err.ndim == 0)\n               ^^^^^^^^\n\u001b[1m\u001b[31mE       AttributeError: 'NoneType' object has no attribute 'ndim'\u001b[0m\n\n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:192: AttributeError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_error_local\u001b[0m - AttributeError: 'NoneType' object has no attribute 'ndim'\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "EJmg",
      "code_hash": "deb2b9bc0384e238cd796eab13f6e964",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='EJmg-0' random-id='2395e96d-adf2-9bde-0880-e2f794fb40f6'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;error&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "UmEG",
      "code_hash": "025a2aee47194f1b3b606749a8f3d7d0",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "vEBW",
      "code_hash": "51cac21f8edf170d39b4b534a353b34b",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><h3 id=\"question-4-minibatch-stochastic-gradient-descent\">Question 4 - (Minibatch) Stochastic Gradient descent</h3>\n<span class=\"paragraph\">Finally, implement a minibatch version of the stochastic gradient descent method to optimize a linear classifier, using PyTorch.  Form a linear classifier specified by a matrix <marimo-tex class=\"arithmatex\">||(W \\in \\mathbb{R}^{k \\times n}||)</marimo-tex> (make sure to set <code>requires_grad=True</code> for this tensor, so you can compute gradients).</span>\n<span class=\"paragraph\">Your function should iterate over the dataset <code>epochs</code> times, each time spliting the data into chunks of size <code>batch_size</code> (you can use the <code>torch.split()</code> function for this). For each of these chunks, compute the predictions of the linear classifier on this batch, compute the gradient of the cross entropy loss between these predictions and the desired outputs, and update <marimo-tex class=\"arithmatex\">||(W||)</marimo-tex> by taking a step (scaled by <code>step_size</code>) in the direction of the negative gradient.  Note that after you've taken this step, you'll want to zero out the gradients of <marimo-tex class=\"arithmatex\">||(W||)</marimo-tex> (otherwise, new gradients will be <em>added</em> on top of the older existing gradients in the <code>.grad</code> variable, which is not what you want).</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "kLmu",
      "code_hash": "e9ba028afb5fdfc9447326147ed95568",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "IpqN",
      "code_hash": "edc5ba1918771170d66ce9e5d962620f",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stdout",
          "text": "\u001b[31mF\u001b[0m\u001b[31m                                                                        [100%]\u001b[0m\n=================================== FAILURES ===================================\n\u001b[31m\u001b[1m__________________________ .hw2.test_train_sgd_local ___________________________\u001b[0m\n\n    def test_train_sgd_local():\n>       test_train_sgd(train_sgd)\n\n\u001b[1m\u001b[31mmarimo://hw2_marimo.py#cell_id=cell\u001b[0m:2: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ntrain_sgd = <function train_sgd at 0x1634e5900>\n\n    def test_train_sgd(train_sgd):\n        X = torch.tensor([[2.0, 1.0], [1.0, 2.0], [-2.0, -1.0], [-1.0, -2.0]])\n        y = torch.tensor([1, 1, 0, 0])\n    \n        W_small = train_sgd(X, y, epochs=1, step_size=0.1, batch_size=2)\n        W_expected = torch.tensor([[-0.13340412, -0.13340412], [0.13340412, 0.13340412]])\n>       assert(torch.allclose(W_small, W_expected, atol=1e-6))\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\u001b[1m\u001b[31mE       TypeError: allclose(): argument 'input' (position 1) must be Tensor, not NoneType\u001b[0m\n\n\u001b[1m\u001b[31mhw2_tests.py\u001b[0m:209: TypeError\n=================================== Overview ===================================\n\nSummary:\nTotal: 1, Passed: 0, Failed: 1, Errors: 0, Skipped: 0\n\u001b[36m\u001b[1m=========================== short test summary info ============================\u001b[0m\n\u001b[31mFAILED\u001b[0m .::\u001b[1mtest_train_sgd_local\u001b[0m - TypeError: allclose(): argument 'input' (position 1) must be Tensor, not No...\n",
          "mimetype": "text/plain"
        }
      ]
    },
    {
      "id": "dxZZ",
      "code_hash": "2b92c40d45ad8566da3ba717048147e8",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/html": "<marimo-ui-element object-id='dxZZ-0' random-id='6d13696e-f9dc-1b5a-5841-7e76b0a7284e'><marimo-button data-initial-value='0' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;submit &lt;code&gt;train_sgd&lt;/code&gt;&lt;/span&gt;&lt;/span&gt;&quot;' data-kind='&quot;neutral&quot;' data-disabled='false' data-full-width='false'></marimo-button></marimo-ui-element>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "dlnW",
      "code_hash": "c90e2c878392ec550fc14b28cecdd44c",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "TTti",
      "code_hash": "5267bc14bcdeecac413272f105fa5941",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">If you implemented this correctly, you should be able to train a classifier using code like the following.</span></span>"
          }
        }
      ],
      "console": []
    },
    {
      "id": "RKFZ",
      "code_hash": "3925ce90ecb453a8d7712a5010de8bf5",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/plain": ""
          }
        }
      ],
      "console": []
    },
    {
      "id": "IaQp",
      "code_hash": "b203984d2d20f8dba9ec44f352b5d933",
      "outputs": [
        {
          "type": "data",
          "data": {
            "application/json": "[\"text/html:<marimo-ui-element object-id='RKFZ-0' random-id='bd773c35-ac5a-326e-75a7-d6d8f2b7a52a'><marimo-slider data-initial-value='0.1' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;Step size&lt;/span&gt;&lt;/span&gt;&quot;' data-start='0.01' data-stop='1.0' data-step='0.01' data-steps='[]' data-debounce='true' data-disabled='false' data-orientation='&quot;horizontal&quot;' data-show-value='true' data-include-input='false' data-full-width='false'></marimo-slider></marimo-ui-element>\", \"text/html:<marimo-ui-element object-id='RKFZ-1' random-id='bc024d34-0440-cb5b-a9b9-47b0c5cac09f'><marimo-slider data-initial-value='5' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;Epochs&lt;/span&gt;&lt;/span&gt;&quot;' data-start='1' data-stop='50' data-step='1' data-steps='[]' data-debounce='true' data-disabled='false' data-orientation='&quot;horizontal&quot;' data-show-value='true' data-include-input='false' data-full-width='false'></marimo-slider></marimo-ui-element>\", \"text/html:<marimo-ui-element object-id='RKFZ-2' random-id='688fac82-8a01-3b43-2b23-56c0c67f0bde'><marimo-slider data-initial-value='100' data-label='&quot;&lt;span class=&#92;&quot;markdown prose dark:prose-invert contents&#92;&quot;&gt;&lt;span class=&#92;&quot;paragraph&#92;&quot;&gt;Batch size&lt;/span&gt;&lt;/span&gt;&quot;' data-start='10' data-stop='1000' data-step='10' data-steps='[]' data-debounce='true' data-disabled='false' data-orientation='&quot;horizontal&quot;' data-show-value='true' data-include-input='false' data-full-width='false'></marimo-slider></marimo-ui-element>\"]"
          }
        }
      ],
      "console": []
    },
    {
      "id": "IWgg",
      "code_hash": "3d59667350400b4b8146df45e31ebfb4",
      "outputs": [
        {
          "type": "error",
          "ename": "exception",
          "evalue": "'NoneType' object has no attribute 'T'",
          "traceback": []
        }
      ],
      "console": [
        {
          "type": "stream",
          "name": "stderr",
          "text": "<span class=\"codehilite\"><div class=\"highlight\"><pre><span></span><span class=\"gt\">Traceback (most recent call last):</span>\n  File <span class=\"nb\">&quot;/var/folders/w2/5g3ht4h93vqb3l6zf_5hv6w40000gp/T/marimo_99527/__marimo__cell_IWgg_.py&quot;</span>, line <span class=\"m\">7</span>, in <span class=\"n\">&lt;module&gt;</span>\n<span class=\"w\">    </span><span class=\"n\">mo</span><span class=\"o\">.</span><span class=\"n\">md</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;**Test error: </span><span class=\"si\">{</span><span class=\"n\">error</span><span class=\"p\">(</span><span class=\"n\">X_test</span><span class=\"w\"> </span><span class=\"o\">@</span><span class=\"w\"> </span><span class=\"n\">W</span><span class=\"o\">.</span><span class=\"n\">T</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y_test</span><span class=\"p\">)</span><span class=\"si\">:</span><span class=\"s2\">.4f</span><span class=\"si\">}</span><span class=\"s2\">**&quot;</span><span class=\"p\">)</span>\n<span class=\"w\">                                          </span><span class=\"pm\">^^^</span>\n<span class=\"gr\">AttributeError</span>: <span class=\"n\">&#39;NoneType&#39; object has no attribute &#39;T&#39;</span>\n</pre></div>\n</span>",
          "mimetype": "application/vnd.marimo+traceback"
        }
      ]
    },
    {
      "id": "fCoF",
      "code_hash": "75cce2f13583049075ac55b9b5f81143",
      "outputs": [
        {
          "type": "data",
          "data": {
            "text/markdown": "<span class=\"markdown prose dark:prose-invert contents\"><span class=\"paragraph\">Try to play around with different step sizes, epochs, and batch sizes until you can get a classifier with error under 8% (then best we've managed is slightly less than 7.5%).</span></span>"
          }
        }
      ],
      "console": []
    }
  ]
}